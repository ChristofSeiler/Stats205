---
title: "Permutation Tests (Part 2)"
author: "Christof Seiler"
date: "Stanford University, Spring 2016, STATS 205"
output:
  ioslides_presentation:
    incremental: yes
    smaller: no
    transition: faster
    widescreen: yes
  beamer_presentation:
    incremental: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
set.seed(1234)
library(ggplot2)
library(HistData)
```

## Assumption: Exchangeable Observations

* A sufficient condition for permutation test is exchangeable of observations
* Consider a collection of random variables 
$$ X_1,\dots,X_n $$
* If their joint distribution are equal under permuations $\pi$
$$P_{X_1,\dots,X_n}(A) = P_{X_{\pi(1)},\dots,X_{\pi(n)}}(A)$$ 
* then $X_1,\dots,X_n$ are called exchangable 
* This is a weaker assumption than indepdendence of observations in the combined sample

## Assumption: Exchangeable Observations

* Some examples:
* Independent and identically distributed observations are exchangeable
* Samples without replacement from a finite population are exchangeable:
    * An urn contains $b$ black balls, $r$ red balls, $y$ yellow balls, and so forth
    * A series of balls are extracted from the urn 
    * After the $i$th extraction, the color of the ball $X_i$ is noted and $k$ balls of the same color are added to the urn, 
    * where $k$ can be any integer, positive, negative, or zero
    * The set of random events $\{X_i\}$ form an exchangeable sequence
* Dependent normally distributed random variables $\{X_i\}$ for which the variance of $X_i$ is a constant independent of $i$ and the covariance of $X_i$ and $X_j$ is a constant independent of $i$ and $j$

## Assumption: Exchangeable Observations

* Sometimes a simple transformation will ensure that observations are exchangeable
* For example, if we know that $X$ comes from a population with mean $\mu$ and distribution $F(x−\mu)$ and 
* an independent observation $Y$ comes from a population with mean $v$ and distribution $F(x−v)$
* then the independent variables $X'=X−\mu$ and $Y'=Y−v$ are exchangeable



## Example: Letter Sequences in Bible

* Suppose we have text written in foreign language
* We are asked whether text is meaningful or meaningless
* We have very limitted partial dictionary: e.g. umbrella and rain
* Can we decide using this limited dictionary whether text is meaningful?
* Check whether conceputally related words appear in close proximity
* If text is meaningless, we don't expect this to happen very often
* If text is meaningful, we expect this to happen more often than by pure chance

## Example: Letter Sequences in Bible

<div class="columns-2">
```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("BibleExampleText1.png")
```

```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("BibleExampleText2.png")
```
</div>
Source: Witztum, Rips, and Rosenberg (1994). Equidistant Letter Sequences in the Book of Genesis

## Example: Letter Sequences in Bible

* Write bible text as a big two-dimensional array of letters ignoring spaces (fix line width)
1. Define distance between two words $w$ and $w'$: Euclidean distance $d(w,w') =$  
squared distance between consecutive letters of $w$ +  
squared distance between consecutive letters of $w'$ +  
minimal distance between a letter from $w$ and $w'$
2. Define a statistic: Average distance between a set of predefined word pairs calculated over the entire text
3. Choose word pair list: From other book (Encyclopedia of Great Men in Israel): 32 Rabbi names and their birthdays
4. Compute null distribution of average distance between all the word pairs using permutations

## Example: Letter Sequences in Bible

* They computed $p$-value using $999,999$ random name--birthday permutations (from the total of $32!$ permutations to assign $i$th name of Rabbi to randomly permuted birthday)
* Rank the observed statistics among the permutatations
* They rejected the null hypothesis that the name--birthday are not close with $p$-value $0.00002$
* For more details see: Witztum, Rips, and Rosenberg (1994). Equidistant Letter Sequences in the Book of Genesis

## Modern Application in Neuroimaging

```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("Brain_Cortex_Harvard.png")
```

## Modern Application in Neuroimaging

* Explain neuroscience imaging data
* Explain significant cluster permutation test
* Paper: Nichols and Holmes, Nonparametric Permutation Tests For Functional Neuroimaging: A Primer with Examples

## Example Final Project: Autistic Brain

* Example for a project based on my autistic brain imaging example

## References

* Good (2005). Permutations, Parametric, and Boostrap Test of Hypothesis
* Witztum, Rips, and Rosenberg (1994). Equidistant Letter Sequences in the Book of Genesis
* Nichols and Holmes (2001). Nonparametric Permutation Tests For Functional Neuroimaging: A Primer with Examples
