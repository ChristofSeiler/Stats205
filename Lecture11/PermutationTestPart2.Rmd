---
title: "Permutation Tests (Part 2)"
author: "Christof Seiler"
date: "Stanford University, Spring 2016, STATS 205"
output:
  ioslides_presentation:
    incremental: yes
    smaller: no
    transition: faster
    widescreen: yes
  beamer_presentation:
    incremental: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
set.seed(1234)
library(ggplot2)
library(HistData)
```

## Assumption: Exchangeable Observations

* A sufficient condition for permutation test is exchangeable of observations
* Consider a collection of random variables 
$$ X_1,\dots,X_n $$
* If their joint distribution are equal under all possible permuations $\pi$
$$ P\left( X_1=x_1,\dots,X_n=x_1 \right) = P \left( X_{\pi(1)}=x_1,\dots,X_{\pi(n)}=x_n \right)$$
for any sequence of possible values $x_1,\dots,x_n$, 
* then $X_1,\dots,X_n$ are called exchangable 
* This is a weaker assumption than indepdendence of observations in the combined sample

## Example: Exchangeability and Independence

<div class="columns-2">
```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("TreeDiagram.JPG")
```

```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("TreeProbabilities.JPG")
```
</div>

## Exchangeability and de Finetti's Theorem

* Suppose $X_1,\dots,X_n$ are conditionally i.i.d. given some unknown parameter $\theta$ 
* Then for any permutation $\pi$ of $\{1,...,n\}$ and any set of values $(x_1,\dots,x_n)$
* $X_i$'s are conditionally i.i.d. 
$$f(x_1,\dots,x_n) = \int f(x_1,\dots,x_n | \theta) p(\theta) d\theta = \int \left( \prod_{i=1}^n f(x_i|\theta) \right) p(\theta) d\theta$$
* product does not depend on order:
$$= \int \left( \prod_{i=1}^n f(x_{\pi(i)} | \theta) \right) p(\theta) d\theta = f\left( x_{\pi(i)},\dots,x_{\pi(n)} \right)$$

## Exchangeability and de Finetti's Theorem

* This means:
$$ 
X_1,\dots,X_n \text{ are exchangeable for all $n$ }
\Leftarrow
\begin{cases}
X_1,\dots,X_n \, \big| \, \theta \text{ i.i.d. } \\
\theta \sim p(\theta)
\end{cases}
$$

* In the other direction:
    * de Finetti showed in 1931 that all infinite exchangeable binary sequences are mixtures of Bernoulli sequences
    * Hewitt and Savage (1955) generalized de Finetti's result, the main idea can be summarized
    * Diaconis and Freedman (1980) generalized it to finite sequences of random variables

## Example: Letter Sequences in Bible

* Suppose we have text written in foreign language
* We are asked whether text is meaningful or meaningless
* We have very limitted partial dictionary: e.g. umbrella and rain
* Can we decide using this limited dictionary whether text is meaningful?
* Check whether conceputally related words appear in close proximity
* If text is meaningless, we don't expect this to happen very often
* If text is meaningful, we expect this to happen more often than by pure chance

## Example: Letter Sequences in Bible

<div class="columns-2">
```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("BibleExampleText1.png")
```

```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("BibleExampleText2.png")
```
</div>
Source: Witztum, Rips, and Rosenberg (1994). Equidistant Letter Sequences in the Book of Genesis

## Example: Letter Sequences in Bible

* Write bible text as a big two-dimensional array of letters ignoring spaces (fix line width)
1. Define distance between two words $w$ and $w'$: Euclidean distance $d(w,w') =$  
squared distance between consecutive letters of $w$ +  
squared distance between consecutive letters of $w'$ +  
minimal distance between a letter from $w$ and $w'$
2. Define a statistic: Average distance between a set of predefined word pairs calculated over the entire text
3. Choose word pair list: From other book (Encyclopedia of Great Men in Israel): 32 Rabbi names and their birthdays
4. Compute null distribution of average distance between all the word pairs using permutations

## Example: Letter Sequences in Bible

* They computed $p$-value using $999\,999$ random name--birthday permutations (from the total of $32!$ permutations to assign $i$th name of Rabbi to randomly permuted birthday)
* Rank the observed statistics among the permutatations
* They rejected the null hypothesis that the name--birthday are not close with $p$-value $0.00002$
* For more details see: Witztum, Rips, and Rosenberg (1994). Equidistant Letter Sequences in the Book of Genesis

## Modern Application in Neuroimaging

```{r, out.height = 400, fig.retina = NULL, echo=FALSE}
knitr::include_graphics("Brain_Cortex_Harvard.png")
```

## Modern Application in Neuroimaging

* Explain neuroscience imaging data
* Explain significant cluster permutation test
* Paper: Nichols and Holmes, Nonparametric Permutation Tests For Functional Neuroimaging: A Primer with Examples

## Example Final Project: Autistic Brain

* Example for a project based on my autistic brain imaging example

## References

* Cordani and Wechsler (2006). Teaching Independence and Exchangeability
* Diaconis and Freedman (1980). Finite exchangeable sequences
* de Finetti (1972). Probability Induction and Statistics
* Hewitt and Savage (1955). Symmetric measures on Cartesian products
* Peter Hoff (2009). A First Course in Bayesian Statistical Methods
* Good (2005). Permutations, Parametric, and Boostrap Test of Hypothesis
* Witztum, Rips, and Rosenberg (1994). Equidistant Letter Sequences in the Book of Genesis
* Nichols and Holmes (2001). Nonparametric Permutation Tests For Functional Neuroimaging: A Primer with Examples
