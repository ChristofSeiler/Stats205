---
title: "ANOVA"
author: "Christof Seiler"
date: "Stanford University, Spring 2016, STATS 205"
output:
  beamer_presentation:
    incremental: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
set.seed(1234)
```

## Overview

Before:

* One-Sample, Two-Sample Problems (one or two populations)

Today:

* ANOVA (three or more populations)

## What is ANOVA?

* Classical ANOVA for balanced data does three things at once:

1. Additive data decomposition of the variance of each component
2. Comparisons of mean squares
3. Linear model fit

## One-Way ANOVA

* Determine the effect of a single factor $A$ on a response over a specific population
* Assume $A$ consists of $k$ levels or treatmens
* In a completely randomize design, $n$ subjects are randomly selected from the reference population
* $n_j$ randomly assigned to level $i = 1,\dots,k$
* Let $j$th be the response in the $i$th level denoted by $Y_{ij}$, $j = 1,\dots,n$
* The **assumptions:**
    * Responses are independent of another
    * Distribution among levels differ by at most shifts in location

## One-Way ANOVA

* The full **model** is
$$Y_{ij} = \mu_i + e_{ij}, \hspace{0.5cm} j=1,\dots,n, \hspace{0.5cm} i = 1,\dots,k$$
with 
    * iid random errors $e_{ij}$ with density $f(x)$ and distribution $F(x)$
    * $\mu_i$ location parameter of $i$th level (for us this will be the median)
* The **data:**
$$
\begin{tabular}{cccc}
\hline
\multicolumn{4}{c}{Treatment} \\
1 & 2 & \dots & k \\
\hline
$Y_{11}$ & $Y_{12}$ & $\dots$ & $Y_{1k}$ \\
$Y_{21}$ & $Y_{22}$ & \dots & $Y_{2k}$ \\
\vdots & \vdots &       & \vdots \\
$Y_{j1}$ & $Y_{j2}$ & \dots & $Y_{jk}$ 
\end{tabular}
$$

## One-Way ANOVA

* The parameters of interest are 
$$\delta_{ii'} = \mu_{i'} - \mu_i, \hspace{0.5cm} i \ne i', \hspace{0.5cm} i = 1,\dots,k$$
* The usual statistical analysis is the hypothesis test
$$H_0: \mu_1 = \cdots = \mu_k \hspace{0.5cm} \text{versus} \hspace{0.5cm} H_A: \mu_i \ne \mu_{i'}$$
* Followed by pairwise confidence intervals $\delta_{ii'}$

## Kruskal-Wallis Test

* Total sample size $n = \sum_{i=1}^n n_i$
* Rank $R_{ij}$ of response $Y_{ij}$ among all $n$ observations; ranking done without knowledge of treatment
* Let $\overline{R_i}$ denote the average of the ranks for sample $i$
* The **Kruskal-Wallis test statistic**
$$H = \frac{12}{n(n+1)} \sum_{i=1}^n n_i \left( \overline{R}_i - \frac{n+1}{2}\right)^2$$
* Standardized weighted average of the squared deviations of the $R_i$ from the average of all ranks $(n + 1)/2$
* Asymptotically $\chi^2$ distributed with $k-1$ degrees of freedom

## Kruskal-Wallis Test (Example)

* Mucociliary efficiency from the rate of dust in the three groups: 
    * normal subjects, 
    * subjects with obstructive airway disease, and 
    * subjects with asbestosis
* Responses are the mucociliary clearance half-times of the subjects
* Sample sizes: $n_1 = n_3 = 5$ and $n_2 = 4$

## Kruskal-Wallis Test (Example)

```{r echo=TRUE}
normal = c(2.9,3.0,2.5,2.6,3.2)
obstruct = c(3.8,2.7,4.0,2.4)
asbestosis = c(2.8,3.4,3.7,2.2,2.0)
x = c(normal,obstruct,asbestosis)
g = c(rep(1,5),rep(2,4),rep(3,5))
test = kruskal.test(x,g)
test$statistic
test$p.value
```
