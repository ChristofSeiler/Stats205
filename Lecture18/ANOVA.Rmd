---
title: "ANOVA"
author: "Christof Seiler"
date: "Stanford University, Spring 2016, STATS 205"
output:
  beamer_presentation:
    incremental: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
set.seed(1234)
```

## Overview

Before:

* One-Sample, Two-Sample Problems (one or two populations)

Today:

* ANOVA (two or more populations)

<!--
## What is ANOVA?

* Classical ANOVA for balanced data does three things at once:

1. Additive data decomposition of the variance of each component
2. Comparisons of mean squares
3. Linear model fit
-->

## One-Way ANOVA

* Determine the effect of a single factor $A$ on a response over a specific population
* Assume $A$ consists of $k$ levels or treatmens
* In a completely randomize design, $n$ subjects are randomly selected from the reference population
* $n_j$ randomly assigned to treatment $j = 1,\dots,k$
* Let $i$th be the response in the $j$th treatment denoted by $Y_{ij}$, $i = 1,\dots,n_j$
* **Assumptions:**
    * Responses are independent of another
    * Distribution among levels differ by at most shifts in location

## One-Way ANOVA

* **Data**:
$$
\begin{tabular}{cccc}
\hline
\multicolumn{4}{c}{Treatment} \\
1 & 2 & \dots & k \\
\hline
$Y_{11}$ & $Y_{12}$ & $\dots$ & $Y_{1k}$ \\
$Y_{21}$ & $Y_{22}$ & \dots & $Y_{2k}$ \\
\vdots & \vdots &       & \vdots \\
$Y_{n_j1}$ & $Y_{n_j2}$ & \dots & $Y_{n_jk}$ 
\end{tabular}
$$
* **Model**
$$Y_{ij} = \theta + \mu_i + e_{ij}, \hspace{0.5cm} i=1,\dots,n_j, \hspace{0.5cm} j = 1,\dots,k$$
with 
    * overall median $\theta$
    * $\mu_i$ is the treatment effect
    * $e_{ij}$ samples from continuous distribution with median $0$

## One-Way ANOVA

* The null hypothesis
$$H_0: \mu_1 = \dots = \mu_k $$
underlying distributions $F_1,\dots,F_k$ are connected through the relationship
$$F_j(t) = F(t-\mu_j), -\infty < t < \infty$$
* The alternative is that at least two of the treatment are not equal 
$$H_A: \mu_1,\dots,\mu_k \text{ not all equal}$$

## Kruskal-Wallis Test

* Total sample size $n = \sum_{j=1}^k n_j$
* Rank $R_{ij}$ of response $Y_{ij}$ among all $n$ observations; ranking done without knowledge of treatment
* Let $R_{.j}$ denotes the average of the ranks for sample $j$
* The **Kruskal-Wallis test statistic**
$$H = \frac{12}{n(n+1)} \sum_{j=1}^k n_j \left( R_{.j} - \frac{n+1}{2}\right)^2$$
* Asymptotically $\chi^2$ distributed with $k-1$ degrees of freedom

## Kruskal-Wallis Test

* Motivation for the test
* The **Kruskal-Wallis test statistic**
$$H = \frac{12}{n(n+1)} \sum_{j=1}^k n_j \left( R_{.j} - \frac{n+1}{2}\right)^2$$
* The average rank sample $j = 1,\dots,k$ is 
$$\operatorname{E_{H_0}}(R_{.j}) = \operatorname{E_{H_0}} \left( \frac{1}{n_j} \sum_{i=1}^{n_j} R_{ij} \right) = \frac{1}{n_j} \sum_{i=1}^{n_j} \operatorname{E_{H_0}}(R_{ij}) = \frac{n + 1}{2}$$

## Kruskal-Wallis Test (Example)

* Mucociliary efficiency from the rate of dust in the three groups: 
    * normal subjects, 
    * subjects with obstructive airway disease, and 
    * subjects with asbestosis
* Responses are the mucociliary clearance half-times of the subjects
* Sample sizes: $n_1 = n_3 = 5$ and $n_2 = 4$

## Kruskal-Wallis Test (Example)

```{r echo=TRUE}
normal = c(2.9,3.0,2.5,2.6,3.2)
obstruct = c(3.8,2.7,4.0,2.4)
asbestosis = c(2.8,3.4,3.7,2.2,2.0)
x = c(normal,obstruct,asbestosis)
g = c(rep(1,5),rep(2,4),rep(3,5))
test = kruskal.test(x,g)
test$statistic
test$p.value
```

## Two-Way ANOVA

* Same as before but now we have blocks:
$$
\begin{tabular}{l|cccc}
\hline
& \multicolumn{4}{c}{Treatment} \\
Blocks & 1 & 2 & \dots & n \\
\hline
1 & $Y_{111}$ & $Y_{121}$ & $\dots$ & $Y_{1k1}$ \\
& \vdots & \vdots &       & \vdots \\
& $Y_{11c_{11}}$ & $Y_{12c_{12}}$ & \dots & $Y_{1kc_{1k}}$ \\
2 & $Y_{211}$ & $Y_{221}$ & $\dots$ & $Y_{2k1}$ \\
& \vdots & \vdots &       & \vdots \\
& $Y_{21c_{21}}$ & $Y_{22_{c_{22}}}$ & \dots & $Y_{2kc_{2k}}$ \\
& \vdots & \vdots &       & \vdots \\
\end{tabular}
$$
* The **Friedman test** is analog to the Kruskal-Wallis test

<!--
## Two-Way ANOVA

* The full **model** is
$$Y_{kj} = \alpha + \beta_j + b_k + e_{kj}, \hspace{0.5cm} k=1,\dots,n, \hspace{0.5cm} j = 1,\dots,k$$
with 
    * $\alpha$ is an intercept parameter
    * $\beta_j$ is the $j$th treatment effect
    * $b_k$ is the random effect due to cluster $k$, and
    * $\epsilon_{kj}$ is the $jk$th random error
    * assume that the random errors are iid and are independent of the random effects

## Friedman's Test

* The **Friedman test statistics**:
$$\overline{R}_{.j} = \frac{\sum_{k=1}^m R_{kj}}{m}$$
$$H = \frac{12m}{n(n+1)} \sum_{j=1}^n n_i \left( \overline{R}_{.j} - \frac{n+1}{2}\right)^2$$
-->

## Median Polish

* For special case of no repetiations (one observation per block/treatment cell)

TODO

## Tukey Additivity Plot

TODO
